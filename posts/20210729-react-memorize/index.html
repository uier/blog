<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ç­†è¨˜ React.js ä¸­ useMemo Hook | TzuWei's Blog ğŸ </title><meta name=keywords content="React.js"><meta name=description content="å‰è¨€ æš‘å‡å›å»å…¬å¸å¯¦ç¿’æ™‚æŠŠ React æ–‡ä»¶æ‹¿å‡ºä¾†é‡æ–°è¤‡ç¿’ä¸€æ¬¡ï¼Œé †ä¾¿åœ¨ä¸€äº›å¯ä»¥å„ªåŒ–çš„åœ°æ–¹ä½¿ç”¨ useMemo, useCallbackï¼Œé †æ‰‹åšå€‹ç´€éŒ„ã€‚
è¢«è¨ˆç®—å‡ºä¾†çš„ç‹€æ…‹ä½¿ç”¨ useMemo ç¯„ä¾‹ï¼šè¨ˆç®—æŒ‰éˆ•ä½•æ™‚æ‡‰å•Ÿç”¨ disabled æ¨£å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  // Before: è‡ªå·±å¯« useEffect å»ç›£è½ä¾è³´ï¼Œåœ¨ä¾è³´è®Šå‹•æ™‚é‡æ–°è³¦å€¼ const [input, setInput] = useState('') const [isInputError, setIsInputError] = useState(false) const [isBtnDisabled, setIsBtnDisabled] = useState(true) useEffect(() => { setIsBtnDisabled(input === '' || isInputError) }, [input, isInputError]) // ------------------------------------------------------ // After: ä½¿ç”¨ useMemo  const [input, setInput] = useState('') const [isInputError, setIsInputError] = useState(false) const isBtnDisabled = useMemo(() => { return (input === '' || isInputError) }, [input, isInputError])   useMemo ä¹Ÿå¯ä»¥ memorize ä¸€å€‹ functional component"><meta name=author content><link rel=canonical href=https://uier.github.io/blog/posts/20210729-react-memorize/><link href=/blog/assets/css/stylesheet.min.c076f7e57fc898d79896f01b86b45a2283c95da97e7afd41700b61e878931da3.css integrity="sha256-wHb35X/ImNeYlvAbhrRaIoPJXal+ev1BcAth6HiTHaM=" rel="preload stylesheet" as=style><link rel=icon href=https://uier.github.io/blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://uier.github.io/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://uier.github.io/blog/favicon-32x32.png><link rel=apple-touch-icon href=https://uier.github.io/blog/apple-touch-icon.png><link rel=mask-icon href=https://uier.github.io/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.81.0"><script async src="https://www.googletagmanager.com/gtag/js?id=G-EWHVMQWQYV"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-EWHVMQWQYV')</script><meta property="og:title" content="ç­†è¨˜ React.js ä¸­ useMemo Hook"><meta property="og:description" content="å‰è¨€ æš‘å‡å›å»å…¬å¸å¯¦ç¿’æ™‚æŠŠ React æ–‡ä»¶æ‹¿å‡ºä¾†é‡æ–°è¤‡ç¿’ä¸€æ¬¡ï¼Œé †ä¾¿åœ¨ä¸€äº›å¯ä»¥å„ªåŒ–çš„åœ°æ–¹ä½¿ç”¨ useMemo, useCallbackï¼Œé †æ‰‹åšå€‹ç´€éŒ„ã€‚
è¢«è¨ˆç®—å‡ºä¾†çš„ç‹€æ…‹ä½¿ç”¨ useMemo ç¯„ä¾‹ï¼šè¨ˆç®—æŒ‰éˆ•ä½•æ™‚æ‡‰å•Ÿç”¨ disabled æ¨£å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  // Before: è‡ªå·±å¯« useEffect å»ç›£è½ä¾è³´ï¼Œåœ¨ä¾è³´è®Šå‹•æ™‚é‡æ–°è³¦å€¼ const [input, setInput] = useState('') const [isInputError, setIsInputError] = useState(false) const [isBtnDisabled, setIsBtnDisabled] = useState(true) useEffect(() => { setIsBtnDisabled(input === '' || isInputError) }, [input, isInputError]) // ------------------------------------------------------ // After: ä½¿ç”¨ useMemo  const [input, setInput] = useState('') const [isInputError, setIsInputError] = useState(false) const isBtnDisabled = useMemo(() => { return (input === '' || isInputError) }, [input, isInputError])   useMemo ä¹Ÿå¯ä»¥ memorize ä¸€å€‹ functional component"><meta property="og:type" content="article"><meta property="og:url" content="https://uier.github.io/blog/posts/20210729-react-memorize/"><meta property="article:published_time" content="2021-07-29T18:13:04+08:00"><meta property="article:modified_time" content="2021-07-29T18:13:04+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="ç­†è¨˜ React.js ä¸­ useMemo Hook"><meta name=twitter:description content="å‰è¨€ æš‘å‡å›å»å…¬å¸å¯¦ç¿’æ™‚æŠŠ React æ–‡ä»¶æ‹¿å‡ºä¾†é‡æ–°è¤‡ç¿’ä¸€æ¬¡ï¼Œé †ä¾¿åœ¨ä¸€äº›å¯ä»¥å„ªåŒ–çš„åœ°æ–¹ä½¿ç”¨ useMemo, useCallbackï¼Œé †æ‰‹åšå€‹ç´€éŒ„ã€‚
è¢«è¨ˆç®—å‡ºä¾†çš„ç‹€æ…‹ä½¿ç”¨ useMemo ç¯„ä¾‹ï¼šè¨ˆç®—æŒ‰éˆ•ä½•æ™‚æ‡‰å•Ÿç”¨ disabled æ¨£å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  // Before: è‡ªå·±å¯« useEffect å»ç›£è½ä¾è³´ï¼Œåœ¨ä¾è³´è®Šå‹•æ™‚é‡æ–°è³¦å€¼ const [input, setInput] = useState('') const [isInputError, setIsInputError] = useState(false) const [isBtnDisabled, setIsBtnDisabled] = useState(true) useEffect(() => { setIsBtnDisabled(input === '' || isInputError) }, [input, isInputError]) // ------------------------------------------------------ // After: ä½¿ç”¨ useMemo  const [input, setInput] = useState('') const [isInputError, setIsInputError] = useState(false) const isBtnDisabled = useMemo(() => { return (input === '' || isInputError) }, [input, isInputError])   useMemo ä¹Ÿå¯ä»¥ memorize ä¸€å€‹ functional component"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ç­†è¨˜ React.js ä¸­ useMemo Hook","name":"ç­†è¨˜ React.js ä¸­ useMemo Hook","description":"å‰è¨€ æš‘å‡å›å»å…¬å¸å¯¦ç¿’æ™‚æŠŠ React æ–‡ä»¶æ‹¿å‡ºä¾†é‡æ–°è¤‡ç¿’ä¸€æ¬¡ï¼Œé †ä¾¿åœ¨ä¸€äº›å¯ä»¥å„ªåŒ–çš„åœ°æ–¹ä½¿ç”¨ useMemo, useCallbackï¼Œé †æ‰‹åšå€‹ç´€éŒ„ã€‚\nè¢«è¨ˆç®—å‡ºä¾†çš„ç‹€æ…‹ä½¿ç”¨ useMemo ç¯„ä¾‹ï¼šè¨ˆç®—æŒ‰éˆ•ä½•æ™‚æ‡‰å•Ÿç”¨ disabled æ¨£å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  // Before: â€¦","keywords":["React.js"],"articleBody":"å‰è¨€ æš‘å‡å›å»å…¬å¸å¯¦ç¿’æ™‚æŠŠ React æ–‡ä»¶æ‹¿å‡ºä¾†é‡æ–°è¤‡ç¿’ä¸€æ¬¡ï¼Œé †ä¾¿åœ¨ä¸€äº›å¯ä»¥å„ªåŒ–çš„åœ°æ–¹ä½¿ç”¨ useMemo, useCallbackï¼Œé †æ‰‹åšå€‹ç´€éŒ„ã€‚\nè¢«è¨ˆç®—å‡ºä¾†çš„ç‹€æ…‹ä½¿ç”¨ useMemo ç¯„ä¾‹ï¼šè¨ˆç®—æŒ‰éˆ•ä½•æ™‚æ‡‰å•Ÿç”¨ disabled æ¨£å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  // Before: è‡ªå·±å¯« useEffect å»ç›£è½ä¾è³´ï¼Œåœ¨ä¾è³´è®Šå‹•æ™‚é‡æ–°è³¦å€¼ const [input, setInput] = useState('') const [isInputError, setIsInputError] = useState(false) const [isBtnDisabled, setIsBtnDisabled] = useState(true) useEffect(() = { setIsBtnDisabled(input === '' || isInputError) }, [input, isInputError]) // ------------------------------------------------------ // After: ä½¿ç”¨ useMemo  const [input, setInput] = useState('') const [isInputError, setIsInputError] = useState(false) const isBtnDisabled = useMemo(() = { return (input === '' || isInputError) }, [input, isInputError])   useMemo ä¹Ÿå¯ä»¥ memorize ä¸€å€‹ functional component\nå‚™è¨» åŒæ¨£æ˜¯ç›£è½ä¸€äº› state å»éŸ¿æ‡‰å¦ä¸€å€‹ stateï¼ŒuseMemo çš„æ”¹å¯«æˆ‘è¦ºå¾—å¯è®€æ€§è¼ƒé«˜ã€‚\nåœ¨ Vue.js ä¸­ï¼Œcomputed å±¬æ€§åœ¨åšé¡ä¼¼çš„äº‹æƒ…ï¼Œè·Ÿ React ä¸åŒçš„æ˜¯ï¼ŒVue.js æœƒè‡ªå‹•è¿½è¹¤è¨ˆç®—çš„éç¨‹ç‰½æ‰¯åˆ°å“ªäº›ä¾è³´ï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦ dependency arrayã€‚\nè€å¯¦èªªï¼Œæˆ‘ç¿»äº†ä¸€äº›çš„ realworld exampleï¼Œå»ä¸å¸¸çœ‹åˆ° useMemo è¢«ä½¿ç”¨ï¼Œé‚„è »ä»¤æˆ‘é©šè¨çš„ï¼Œæˆ‘æƒ³ useMemo æ‡‰è©²ä¸åƒ…åƒ…æ˜¯é€™æ¨£ï¼Œæœ‰ç©ºæœƒå†å°‹æ‰¾å®ƒåœ¨å¯¦éš›ä¸Šæ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ã€‚\nåƒè€ƒè³‡æ–™ï¼š\n Hooks API åƒè€ƒ Vue computed   Child Component ä½¿ç”¨ React.memo åœ¨ functional component ä¹‹å‰ï¼ŒReact æä¾› React.Component å’Œ React.PureComponent ä¾†æ’°å¯«å…ƒä»¶ã€‚\nReact.Component - React\nå…¶ä¸­çš„å·®ç•°åœ¨æ–¼ï¼ŒReact.Component éœ€è‡ªè¡Œå¯¦ä½œ shouldComponentUpdate é€™å€‹ function ä¾†æ§åˆ¶åœ¨ props æˆ– states æ›´æ–°å¾Œæ˜¯å¦éœ€è¦é‡æ–° renderï¼Œè€Œ React.PureComponent å‰‡æ²’æœ‰ shouldComponentUpdateï¼Œæœƒä»¥ shallow compare çš„æ–¹å¼ä¾†æ¯”è¼ƒèˆŠçš„ props, states å’Œæ–°çš„ props, states ä¾†æ±ºå®šæ˜¯å¦é‡æ–° renderã€‚\nåœ¨ functional component ä¸­ï¼Œç•¶ parent component è§¸ç™¼äº†é‡æ–°æ¸²æŸ“å¾Œï¼Œchild component ä¹Ÿæœƒé‡æ–° renderï¼Œå³ä½¿ props æ²’æœ‰æ›´æ–°ï¼Œè‹¥è¦é¿å…é€™å€‹å•é¡Œï¼Œæ‡‰è©²ä½¿ç”¨ React.memo ä¾†åŒ…ä½ child componentï¼Œä»–çš„ç”¨é€”æ˜¯å°æ–¼ props åš shallow compare ä¾†æ±ºå®šæ˜¯å¦éœ€è¦é‡æ–° renderã€‚\nå¦å¤–ï¼ŒReact.memo å¯ä»¥åœ¨ç¬¬äºŒå€‹åƒæ•¸å‚³éä¸€å€‹è‡ªå®šç¾©çš„ compare functionï¼Œä¹Ÿå°±æ˜¯ä¿ç•™äº†å½ˆæ€§ï¼Œç•¶ä¸æƒ³è¦ç”¨å…¶é è¨­çš„ shallow compareï¼Œå¯ä»¥è‡ªå·²æ’°å¯«é‚è¼¯ã€‚\nç¯„ä¾‹ï¼šä½¿ç”¨ React.memo åŒ…è£¹å­å…ƒä»¶ æˆ‘åœ¨ codesandbox å¯«äº†ä¸€å€‹ç¯„ä¾‹ï¼Œé»é€²å»å¾Œæ‰“é–‹ console å¯ä»¥ç™¼ç¾ï¼Œä¸€é–‹å§‹åˆå§‹åŒ– App å¾Œä¸‰å€‹ component éƒ½è¢«æ¸²æŸ“å‡ºä¾†ï¼Œä¹‹å¾Œåœ¨æŒ‰ä¸‹ add count1 æŒ‰éˆ•æ™‚ï¼ŒChild1 è·Ÿ Child2 æ›´æ–°äº†ï¼Œå…¶ä¸­æˆ‘å€‘çŸ¥é“ Child1 æœ‰é—œæ³¨ count1 æ‰€ä»¥æ›´æ–°çš„åˆç†ï¼Œä½† Child2 åœ¨é€™å€‹æƒ…æ³ä¸‹å¯ä»¥ä¸å¿…æ›´æ–°ã€‚ è€Œç”¨ React.memo åŒ…èµ·ä¾†çš„ MemoChild2 ä¸æœƒåœ¨æ¯æ¬¡çˆ¶å…ƒä»¶æ›´æ–°å°±è·Ÿè‘—æ›´æ–°ï¼Œè€Œæ˜¯åš shallow compareã€‚\nä½¿ç”¨æ™‚æ©Ÿ æ²’æœ‰ä½¿ç”¨ React.memo å¯èƒ½æœƒå°è‡´å­å…ƒä»¶åšä¸å¿…è¦çš„æ›´æ–°ï¼Œä½†ä½¿ç”¨äº† React.memo ä¹Ÿæœ‰ shallow compare å¸¶ä¾†çš„æˆæœ¬ã€‚\n å•é¡Œï¼šshallow compare çš„æˆæœ¬è·Ÿé‡æ–°æ¸²æŸ“çš„æˆæœ¬ç›¸æ¯”æ˜¯ä¸æ˜¯å°å¾ˆå¤šï¼Ÿ\n å‡å¦‚çˆ¶å…ƒä»¶å°‡æ›´æ–° N æ¬¡ï¼Œè€Œå…¶ä¸­ M æ¬¡ props ä¸¦æ²’æœ‰æ›´æ–°ï¼Œå¦å¤– N-M æ¬¡ props æœ‰æ›´æ–°ï¼Œé‚£éº¼åœ¨ M è¼ƒå°æ™‚æˆ‘å€‘æ‡‰è©²ä¸ä½¿ç”¨ React.memoï¼Œæ‡‰è©²åœ¨ M è¼ƒå¤§æ™‚ä½¿ç”¨ã€‚\né€™æ¨£ä¾†çœ‹ï¼Œåœ¨ Container component èˆ‡ Presentational component ä¹‹é–“å°±ä¸éœ€è¦ç”¨ React.memo åŒ…ä½ Presentational componentï¼Œå› ç‚ºå¹¾ä¹æ¯æ¬¡æ›´æ–°éƒ½æ˜¯å› ç‚º props æ›´æ–°ã€‚\næƒ³ä¸€å€‹ç›¸åçš„æƒ…å¢ƒï¼Œä¾‹å¦‚è¡¨å–® component æœ‰è¼ƒå¤šç‹€æ…‹çš„æƒ…æ³ï¼Œè‹¥æœ‰åŒ…å«å…¶ä»– component å¦‚éŒ¯èª¤æ™‚è¦è·³å‡ºä¾†çš„ Alertï¼Œå› ç‚ºä»–åªé—œå¿ƒå°‘æ•¸ç‹€æ…‹ï¼Œå°±å¯ä»¥ä½¿ç”¨ React.memoï¼Œæˆ–è€…ç”¨ useMemoã€‚\nå‚™è¨» åœ¨ Vue.js ä¸­ï¼Œå­å…ƒä»¶çš„é‡æ¸²æŸ“æ©Ÿåˆ¶é è¨­å°±ä½¿ç”¨ shallow compareï¼Œç›®å‰çœ‹ä¾†åœ¨ React ä¸­è¦è‡ªå·± handleã€‚\nåƒè€ƒè³‡æ–™ï¼š\n React é ‚å±¤ API æˆ‘è©²å¦‚ä½•å¯¦ä½œ shouldComponentUpdateï¼Ÿ é—œæ–¼ props çš„è¨˜æ†¶ï¼ŒReact Memo  ","wordCount":"291","inLanguage":"en","datePublished":"2021-07-29T18:13:04+08:00","dateModified":"2021-07-29T18:13:04+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://uier.github.io/blog/posts/20210729-react-memorize/"},"publisher":{"@type":"Organization","name":"TzuWei's Blog ğŸ ","logo":{"@type":"ImageObject","url":"https://uier.github.io/blog/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://uier.github.io/blog/ accesskey=h title="TzuWei's Blog ğŸ  (Alt + H)">TzuWei's Blog ğŸ </a>
<span class=logo-switches><span class=theme-toggle title="(Alt + T)"><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://uier.github.io/blog/ title=Home><span>Home</span></a></li><li><a href=https://uier.github.io/blog/about/ title=About><span>About</span></a></li><li><a href=https://uier.github.io/blog/archive/ title=Archive><span>Archive</span></a></li><li><a href=https://uier.github.io/blog/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://uier.github.io/blog/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://uier.github.io/blog/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>ç­†è¨˜ React.js ä¸­ useMemo Hook</h1><div class=post-description></div><div class=post-meta>July 29, 2021</div></header><div class=post-content><h2 id=å‰è¨€>å‰è¨€<a hidden class=anchor aria-hidden=true href=#å‰è¨€>#</a></h2><p>æš‘å‡å›å»å…¬å¸å¯¦ç¿’æ™‚æŠŠ React æ–‡ä»¶æ‹¿å‡ºä¾†é‡æ–°è¤‡ç¿’ä¸€æ¬¡ï¼Œé †ä¾¿åœ¨ä¸€äº›å¯ä»¥å„ªåŒ–çš„åœ°æ–¹ä½¿ç”¨ <code>useMemo</code>, <code>useCallback</code>ï¼Œé †æ‰‹åšå€‹ç´€éŒ„ã€‚</p><h2 id=è¢«è¨ˆç®—å‡ºä¾†çš„ç‹€æ…‹ä½¿ç”¨-usememo>è¢«è¨ˆç®—å‡ºä¾†çš„ç‹€æ…‹ä½¿ç”¨ <code>useMemo</code><a hidden class=anchor aria-hidden=true href=#è¢«è¨ˆç®—å‡ºä¾†çš„ç‹€æ…‹ä½¿ç”¨-usememo>#</a></h2><h3 id=ç¯„ä¾‹è¨ˆç®—æŒ‰éˆ•ä½•æ™‚æ‡‰å•Ÿç”¨-disabled-æ¨£å¼>ç¯„ä¾‹ï¼šè¨ˆç®—æŒ‰éˆ•ä½•æ™‚æ‡‰å•Ÿç”¨ disabled æ¨£å¼<a hidden class=anchor aria-hidden=true href=#ç¯„ä¾‹è¨ˆç®—æŒ‰éˆ•ä½•æ™‚æ‡‰å•Ÿç”¨-disabled-æ¨£å¼>#</a></h3><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#6272a4>// Before: è‡ªå·±å¯« useEffect å»ç›£è½ä¾è³´ï¼Œåœ¨ä¾è³´è®Šå‹•æ™‚é‡æ–°è³¦å€¼
</span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> [input, setInput] <span style=color:#ff79c6>=</span> useState(<span style=color:#f1fa8c>&#39;&#39;</span>)
<span style=color:#ff79c6>const</span> [isInputError, setIsInputError] <span style=color:#ff79c6>=</span> useState(<span style=color:#ff79c6>false</span>)
<span style=color:#ff79c6>const</span> [isBtnDisabled, setIsBtnDisabled] <span style=color:#ff79c6>=</span> useState(<span style=color:#ff79c6>true</span>)

useEffect(() =&gt; {
  setIsBtnDisabled(input <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#39;&#39;</span> <span style=color:#ff79c6>||</span> isInputError)
}, [input, isInputError])

<span style=color:#6272a4>// ------------------------------------------------------
</span><span style=color:#6272a4>// After: ä½¿ç”¨ useMemo
</span><span style=color:#6272a4></span>
<span style=color:#ff79c6>const</span> [input, setInput] <span style=color:#ff79c6>=</span> useState(<span style=color:#f1fa8c>&#39;&#39;</span>)
<span style=color:#ff79c6>const</span> [isInputError, setIsInputError] <span style=color:#ff79c6>=</span> useState(<span style=color:#ff79c6>false</span>)
<span style=color:#ff79c6>const</span> isBtnDisabled <span style=color:#ff79c6>=</span> useMemo(() =&gt; {
  <span style=color:#ff79c6>return</span> (input <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#39;&#39;</span> <span style=color:#ff79c6>||</span> isInputError)
}, [input, isInputError])
</code></pre></td></tr></table></div></div><p><code>useMemo</code> ä¹Ÿå¯ä»¥ memorize ä¸€å€‹ functional component</p><h3 id=å‚™è¨»>å‚™è¨»<a hidden class=anchor aria-hidden=true href=#å‚™è¨»>#</a></h3><p>åŒæ¨£æ˜¯ç›£è½ä¸€äº› state å»éŸ¿æ‡‰å¦ä¸€å€‹ stateï¼Œ<code>useMemo</code> çš„æ”¹å¯«æˆ‘è¦ºå¾—å¯è®€æ€§è¼ƒé«˜ã€‚</p><p>åœ¨ Vue.js ä¸­ï¼Œ<code>computed</code> å±¬æ€§åœ¨åšé¡ä¼¼çš„äº‹æƒ…ï¼Œè·Ÿ React ä¸åŒçš„æ˜¯ï¼ŒVue.js æœƒè‡ªå‹•è¿½è¹¤è¨ˆç®—çš„éç¨‹ç‰½æ‰¯åˆ°å“ªäº›ä¾è³´ï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦ dependency arrayã€‚</p><p>è€å¯¦èªªï¼Œæˆ‘ç¿»äº†ä¸€äº›çš„ realworld exampleï¼Œå»ä¸å¸¸çœ‹åˆ° <code>useMemo</code> è¢«ä½¿ç”¨ï¼Œé‚„è »ä»¤æˆ‘é©šè¨çš„ï¼Œæˆ‘æƒ³ <code>useMemo</code> æ‡‰è©²ä¸åƒ…åƒ…æ˜¯é€™æ¨£ï¼Œæœ‰ç©ºæœƒå†å°‹æ‰¾å®ƒåœ¨å¯¦éš›ä¸Šæ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ã€‚</p><p>åƒè€ƒè³‡æ–™ï¼š</p><ul><li><a href=https://zh-hant.reactjs.org/docs/hooks-reference.html#usememo>Hooks API åƒè€ƒ</a></li><li><a href=https://v3.vuejs.org/guide/computed.html#basic-example>Vue computed</a></li></ul><hr><h2 id=child-component-ä½¿ç”¨-reactmemo>Child Component ä½¿ç”¨ React.memo<a hidden class=anchor aria-hidden=true href=#child-component-ä½¿ç”¨-reactmemo>#</a></h2><p>åœ¨ functional component ä¹‹å‰ï¼ŒReact æä¾› <code>React.Component</code> å’Œ <code>React.PureComponent</code> ä¾†æ’°å¯«å…ƒä»¶ã€‚</p><p><a href=https://zh-hant.reactjs.org/docs/react-component.html>React.Component - React</a></p><p>å…¶ä¸­çš„å·®ç•°åœ¨æ–¼ï¼Œ<code>React.Component</code> éœ€è‡ªè¡Œå¯¦ä½œ <code>shouldComponentUpdate</code> é€™å€‹ function ä¾†æ§åˆ¶åœ¨ props æˆ– states æ›´æ–°å¾Œæ˜¯å¦éœ€è¦é‡æ–° renderï¼Œè€Œ <code>React.PureComponent</code> å‰‡æ²’æœ‰ <code>shouldComponentUpdate</code>ï¼Œæœƒä»¥ shallow compare çš„æ–¹å¼ä¾†æ¯”è¼ƒèˆŠçš„ props, states å’Œæ–°çš„ props, states ä¾†æ±ºå®šæ˜¯å¦é‡æ–° renderã€‚</p><p>åœ¨ functional component ä¸­ï¼Œç•¶ parent component è§¸ç™¼äº†é‡æ–°æ¸²æŸ“å¾Œï¼Œchild component ä¹Ÿæœƒé‡æ–° renderï¼Œ<strong>å³ä½¿ props æ²’æœ‰æ›´æ–°</strong>ï¼Œè‹¥è¦é¿å…é€™å€‹å•é¡Œï¼Œæ‡‰è©²ä½¿ç”¨ <code>React.memo</code> ä¾†åŒ…ä½ child componentï¼Œä»–çš„ç”¨é€”æ˜¯å°æ–¼ props åš shallow compare ä¾†æ±ºå®šæ˜¯å¦éœ€è¦é‡æ–° renderã€‚</p><p>å¦å¤–ï¼Œ<code>React.memo</code> å¯ä»¥åœ¨ç¬¬äºŒå€‹åƒæ•¸å‚³éä¸€å€‹è‡ªå®šç¾©çš„ compare functionï¼Œä¹Ÿå°±æ˜¯ä¿ç•™äº†å½ˆæ€§ï¼Œç•¶ä¸æƒ³è¦ç”¨å…¶é è¨­çš„ shallow compareï¼Œå¯ä»¥è‡ªå·²æ’°å¯«é‚è¼¯ã€‚</p><h3 id=ç¯„ä¾‹ä½¿ç”¨-reactmemo-åŒ…è£¹å­å…ƒä»¶>ç¯„ä¾‹ï¼šä½¿ç”¨ <code>React.memo</code> åŒ…è£¹å­å…ƒä»¶<a hidden class=anchor aria-hidden=true href=#ç¯„ä¾‹ä½¿ç”¨-reactmemo-åŒ…è£¹å­å…ƒä»¶>#</a></h3><p>æˆ‘åœ¨ <a href=https://codesandbox.io/s/react-memo-7mhki>codesandbox</a> å¯«äº†ä¸€å€‹ç¯„ä¾‹ï¼Œé»é€²å»å¾Œæ‰“é–‹ console å¯ä»¥ç™¼ç¾ï¼Œä¸€é–‹å§‹åˆå§‹åŒ– App å¾Œä¸‰å€‹ component éƒ½è¢«æ¸²æŸ“å‡ºä¾†ï¼Œä¹‹å¾Œåœ¨æŒ‰ä¸‹ add count1 æŒ‰éˆ•æ™‚ï¼Œ<code>Child1</code> è·Ÿ <code>Child2</code> æ›´æ–°äº†ï¼Œå…¶ä¸­æˆ‘å€‘çŸ¥é“ <code>Child1</code> æœ‰é—œæ³¨ <code>count1</code> æ‰€ä»¥æ›´æ–°çš„åˆç†ï¼Œä½† <code>Child2</code> åœ¨é€™å€‹æƒ…æ³ä¸‹å¯ä»¥ä¸å¿…æ›´æ–°ã€‚
è€Œç”¨ <code>React.memo</code> åŒ…èµ·ä¾†çš„ <code>MemoChild2</code> ä¸æœƒåœ¨æ¯æ¬¡çˆ¶å…ƒä»¶æ›´æ–°å°±è·Ÿè‘—æ›´æ–°ï¼Œè€Œæ˜¯åš shallow compareã€‚</p><h3 id=ä½¿ç”¨æ™‚æ©Ÿ>ä½¿ç”¨æ™‚æ©Ÿ<a hidden class=anchor aria-hidden=true href=#ä½¿ç”¨æ™‚æ©Ÿ>#</a></h3><p>æ²’æœ‰ä½¿ç”¨ <code>React.memo</code> å¯èƒ½æœƒå°è‡´å­å…ƒä»¶åšä¸å¿…è¦çš„æ›´æ–°ï¼Œä½†ä½¿ç”¨äº† <code>React.memo</code> ä¹Ÿæœ‰ shallow compare å¸¶ä¾†çš„æˆæœ¬ã€‚</p><blockquote><p>å•é¡Œï¼šshallow compare çš„æˆæœ¬è·Ÿé‡æ–°æ¸²æŸ“çš„æˆæœ¬ç›¸æ¯”æ˜¯ä¸æ˜¯å°å¾ˆå¤šï¼Ÿ</p></blockquote><p>å‡å¦‚çˆ¶å…ƒä»¶å°‡æ›´æ–° N æ¬¡ï¼Œè€Œå…¶ä¸­ M æ¬¡ props ä¸¦æ²’æœ‰æ›´æ–°ï¼Œå¦å¤– N-M æ¬¡ props æœ‰æ›´æ–°ï¼Œé‚£éº¼åœ¨ M è¼ƒå°æ™‚æˆ‘å€‘æ‡‰è©²ä¸ä½¿ç”¨ <code>React.memo</code>ï¼Œæ‡‰è©²åœ¨ M è¼ƒå¤§æ™‚ä½¿ç”¨ã€‚</p><p>é€™æ¨£ä¾†çœ‹ï¼Œåœ¨ Container component èˆ‡ Presentational component ä¹‹é–“å°±ä¸éœ€è¦ç”¨ <code>React.memo</code> åŒ…ä½ Presentational componentï¼Œå› ç‚ºå¹¾ä¹æ¯æ¬¡æ›´æ–°éƒ½æ˜¯å› ç‚º props æ›´æ–°ã€‚</p><p>æƒ³ä¸€å€‹ç›¸åçš„æƒ…å¢ƒï¼Œä¾‹å¦‚è¡¨å–® component æœ‰è¼ƒå¤šç‹€æ…‹çš„æƒ…æ³ï¼Œè‹¥æœ‰åŒ…å«å…¶ä»– component å¦‚éŒ¯èª¤æ™‚è¦è·³å‡ºä¾†çš„ Alertï¼Œå› ç‚ºä»–åªé—œå¿ƒå°‘æ•¸ç‹€æ…‹ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>React.memo</code>ï¼Œæˆ–è€…ç”¨ <code>useMemo</code>ã€‚</p><h3 id=å‚™è¨»-1>å‚™è¨»<a hidden class=anchor aria-hidden=true href=#å‚™è¨»-1>#</a></h3><p>åœ¨ Vue.js ä¸­ï¼Œå­å…ƒä»¶çš„é‡æ¸²æŸ“æ©Ÿåˆ¶é è¨­å°±ä½¿ç”¨ shallow compareï¼Œç›®å‰çœ‹ä¾†åœ¨ React ä¸­è¦è‡ªå·± handleã€‚</p><p>åƒè€ƒè³‡æ–™ï¼š</p><ul><li><a href=https://zh-hant.reactjs.org/docs/react-api.html>React é ‚å±¤ API</a></li><li><a href=https://zh-hant.reactjs.org/docs/hooks-faq.html#how-do-i-implement-shouldcomponentupdate>æˆ‘è©²å¦‚ä½•å¯¦ä½œ shouldComponentUpdateï¼Ÿ</a></li><li><a href=https://ithelp.ithome.com.tw/articles/10240296>é—œæ–¼ props çš„è¨˜æ†¶ï¼ŒReact Memo</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://uier.github.io/blog/tags/react.js/>React.js</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://uier.github.io/blog/>TzuWei's Blog ğŸ </a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/blog/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.replaceState(null,null,`#${a}`)})});var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>