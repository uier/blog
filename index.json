[{"content":"前陣子，在修資料視覺化的同學寫作業遇到了一個問題，幫他解決後發現裡面有不少東西可以記錄下來。\n這一篇會分成三個部分\n 解決同學遇到的 bug：使用 d3-brush 後文字消失 了解 d3-brush 的行為 d3-axis 顏色的有趣發現  使用 d3-brush 後文字消失 我們要看的是下面這段程式，也可以到我的 observable 看 render 的結果。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Demo\u0026lt;/title\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/d3/5.0.0/d3.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/d3-brush/1.0.4/d3-brush.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;svg width=\u0026#34;100\u0026#34; height=\u0026#34;100\u0026#34;\u0026gt;\u0026lt;/svg\u0026gt; \u0026lt;script\u0026gt; const brush = d3.brush().extent([[0, 0], [100, 100]]); const svg = d3.select(\u0026#34;svg\u0026#34;); const g = svg.append(\u0026#34;g\u0026#34;); g.append(\u0026#34;text\u0026#34;) .attr(\u0026#34;transform\u0026#34;, \u0026#34;translate(0, 50)\u0026#34;) .attr(\u0026#34;font-size\u0026#34;, \u0026#34;15px\u0026#34;) .text(\u0026#34;Hello, world\u0026#34;); // try to comment the code below, and the text will reveal  g.call(brush); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;   問題是這樣子，在\u0026lt;svg\u0026gt;內有一個群組元素\u0026lt;g\u0026gt;，裡面又有一個顯示Hello, world的文字元素\u0026lt;text\u0026gt;，當套用 d3-brush 後文字就消失不見了，若把g.call(brush)註解掉則文字就可以出現。\n打開瀏覽器的開發者工具，在 DOM 裡面還是可以找到\u0026lt;text\u0026gt;，但我們卻看不到他。\n\u0008不過眼尖就會發現上一層的\u0026lt;g\u0026gt;有 attributefill=\u0026quot;none\u0026quot;，因為我們沒有為\u0026lt;text\u0026gt;指定 fill 的顏色，而\u0026lt;g\u0026gt;這個元素會讓他的 children 繼承他的 attribute，所以造成\u0026lt;text\u0026gt;繼承了fill=\u0026quot;none\u0026quot;。關於\u0026lt;g\u0026gt;元素的說明可以看 MDN 的文件 。\n結論是，記得也要在\u0026lt;text\u0026gt;上設定 fill 屬性，就能順利顯示文字：\n1 2 3 4 5  g.append(\u0026#34;text\u0026#34;) .attr(\u0026#34;transform\u0026#34;, \u0026#34;translate(0, 50)\u0026#34;) .attr(\u0026#34;font-size\u0026#34;, \u0026#34;15px\u0026#34;) .attr(\u0026#34;fill\u0026#34;, \u0026#34;black\u0026#34;) .text(\u0026#34;Hello, world\u0026#34;);   d3-brush 的行為 那麼為何上層的\u0026lt;g\u0026gt;會是fill=\u0026quot;none\u0026quot;呢？\n當沒有套用 d3-brush 時，會看到\u0026lt;g\u0026gt;的 fill 是採用預設值黑色，並沒有被設定成fill=\u0026quot;none\u0026quot;，\u0026lt;text\u0026gt;則是因為繼承\u0026lt;g\u0026gt;而也顯示黑色。\n所以我們可以懷疑 d3-brush 把我們的\u0026lt;g\u0026gt;加上了fill=\u0026quot;none\u0026quot;。\n關於 d3-brush 的行為， 文件 裡頭有詳細的說明，主要是下列這段：\n The brush also creates the SVG elements necessary to display the brush selection and to receive input events for interaction. You can add, remove or modify these elements as desired to change the brush appearance; you can also apply stylesheets to modify the brush appearance. The structure of a two-dimensional brush is as follows:\n 1 2 3 4 5 6 7 8 9 10 11 12  \u0026lt;g class=\u0026#34;brush\u0026#34; fill=\u0026#34;none\u0026#34; pointer-events=\u0026#34;all\u0026#34; style=\u0026#34;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\u0026#34;\u0026gt; \u0026lt;rect class=\u0026#34;overlay\u0026#34; pointer-events=\u0026#34;all\u0026#34; cursor=\u0026#34;crosshair\u0026#34; x=\u0026#34;0\u0026#34; y=\u0026#34;0\u0026#34; width=\u0026#34;960\u0026#34; height=\u0026#34;500\u0026#34;\u0026gt;\u0026lt;/rect\u0026gt; \u0026lt;rect class=\u0026#34;selection\u0026#34; cursor=\u0026#34;move\u0026#34; fill=\u0026#34;#777\u0026#34; fill-opacity=\u0026#34;0.3\u0026#34; stroke=\u0026#34;#fff\u0026#34; shape-rendering=\u0026#34;crispEdges\u0026#34; x=\u0026#34;112\u0026#34; y=\u0026#34;194\u0026#34; width=\u0026#34;182\u0026#34; height=\u0026#34;83\u0026#34;\u0026gt;\u0026lt;/rect\u0026gt; \u0026lt;rect class=\u0026#34;handle handle--n\u0026#34; cursor=\u0026#34;ns-resize\u0026#34; x=\u0026#34;107\u0026#34; y=\u0026#34;189\u0026#34; width=\u0026#34;192\u0026#34; height=\u0026#34;10\u0026#34;\u0026gt;\u0026lt;/rect\u0026gt; \u0026lt;rect class=\u0026#34;handle handle--e\u0026#34; cursor=\u0026#34;ew-resize\u0026#34; x=\u0026#34;289\u0026#34; y=\u0026#34;189\u0026#34; width=\u0026#34;10\u0026#34; height=\u0026#34;93\u0026#34;\u0026gt;\u0026lt;/rect\u0026gt; \u0026lt;rect class=\u0026#34;handle handle--s\u0026#34; cursor=\u0026#34;ns-resize\u0026#34; x=\u0026#34;107\u0026#34; y=\u0026#34;272\u0026#34; width=\u0026#34;192\u0026#34; height=\u0026#34;10\u0026#34;\u0026gt;\u0026lt;/rect\u0026gt; \u0026lt;rect class=\u0026#34;handle handle--w\u0026#34; cursor=\u0026#34;ew-resize\u0026#34; x=\u0026#34;107\u0026#34; y=\u0026#34;189\u0026#34; width=\u0026#34;10\u0026#34; height=\u0026#34;93\u0026#34;\u0026gt;\u0026lt;/rect\u0026gt; \u0026lt;rect class=\u0026#34;handle handle--nw\u0026#34; cursor=\u0026#34;nwse-resize\u0026#34; x=\u0026#34;107\u0026#34; y=\u0026#34;189\u0026#34; width=\u0026#34;10\u0026#34; height=\u0026#34;10\u0026#34;\u0026gt;\u0026lt;/rect\u0026gt; \u0026lt;rect class=\u0026#34;handle handle--ne\u0026#34; cursor=\u0026#34;nesw-resize\u0026#34; x=\u0026#34;289\u0026#34; y=\u0026#34;189\u0026#34; width=\u0026#34;10\u0026#34; height=\u0026#34;10\u0026#34;\u0026gt;\u0026lt;/rect\u0026gt; \u0026lt;rect class=\u0026#34;handle handle--se\u0026#34; cursor=\u0026#34;nwse-resize\u0026#34; x=\u0026#34;289\u0026#34; y=\u0026#34;272\u0026#34; width=\u0026#34;10\u0026#34; height=\u0026#34;10\u0026#34;\u0026gt;\u0026lt;/rect\u0026gt; \u0026lt;rect class=\u0026#34;handle handle--sw\u0026#34; cursor=\u0026#34;nesw-resize\u0026#34; x=\u0026#34;107\u0026#34; y=\u0026#34;272\u0026#34; width=\u0026#34;10\u0026#34; height=\u0026#34;10\u0026#34;\u0026gt;\u0026lt;/rect\u0026gt; \u0026lt;/g\u0026gt;   套用後會改變\u0026lt;g\u0026gt;的屬性，另外總共會產生 10 個\u0026lt;rect\u0026gt;：\n \u0026lt;rect class=\u0026quot;overlay\u0026quot; ... /\u0026gt;會覆蓋整個\u0026lt;g\u0026gt;。 \u0026lt;rect class=\u0026quot;selection\u0026quot; ... /\u0026gt;是顯示 brush 後框選到的範圍，可以看到他有設定 fill 為灰色。 後面八個則是用來調整框選範圍大小的控制器，包含了四個邊跟四個角落。  也因此 d3-brush 設定了fill=\u0026quot;none\u0026quot;來隱藏這些\u0026lt;rect\u0026gt;，你也可以打開開發者工具手動把 fill 改成其他顏色看看會如何。在下面這張圖，我把\u0026lt;g\u0026gt;更改成fill=\u0026quot;red\u0026quot;。\n其實在幫同學看這個問題時有看到他嘗試寫了\u0026lt;text color=\u0026quot;black\u0026quot;\u0026gt;，然而 color 在 SVG 中並不是他所想的那樣，下一個部分會再提到 color 這個屬性。\n回頭去想，他之所以會需要在\u0026lt;g\u0026gt;裡面加\u0026lt;text\u0026gt;，是因為想在 x 軸以及 y 軸旁加上文字標籤，這讓我想到我們在 d3 建立 x 軸跟 y 軸時，也都是包含在\u0026lt;g\u0026gt;元素裡的，軸線用的是\u0026lt;path\u0026gt;、tick 跟 label 用的是\u0026lt;line\u0026gt;跟\u0026lt;text\u0026gt;，於是我好奇 d3-axis 是如何設定他們的 fill 屬性。\nd3-axis 的顏色設定 在翻 source code 時讓我發現一件有趣的事情，在 d3 v4（d3-axis \u0026lt;= v1.0.8）時，軸線跟 tick label 被寫死成fill=\u0026quot;#000\u0026quot;，可以看 這段 code ，我同時也附在下圖。\n1 2 3 4 5 6 7 8 9 10 11 12  path = path.merge(path.enter().insert(\u0026#34;path\u0026#34;, \u0026#34;.tick\u0026#34;) .attr(\u0026#34;class\u0026#34;, \u0026#34;domain\u0026#34;) .attr(\u0026#34;stroke\u0026#34;, \u0026#34;#000\u0026#34;)); line = line.merge(tickEnter.append(\u0026#34;line\u0026#34;) .attr(\u0026#34;stroke\u0026#34;, \u0026#34;#000\u0026#34;) .attr(x + \u0026#34;2\u0026#34;, k * tickSizeInner)); text = text.merge(tickEnter.append(\u0026#34;text\u0026#34;) .attr(\u0026#34;fill\u0026#34;, \u0026#34;#000\u0026#34;) .attr(x, k * spacing) .attr(\u0026#34;dy\u0026#34;, orient === top ? \u0026#34;0em\u0026#34; : orient === bottom ? \u0026#34;0.71em\u0026#34; : \u0026#34;0.32em\u0026#34;));   而後來，作者自己開了這個 issue 並更改成fill=\u0026quot;currentcolor\u0026quot;，如下圖。\ncurrentcolor 是什麼？ fill, stroke 這些設定顏色的屬性，除了可以設為一個顏色的 rgb 值、hex 值等，也可以設定為 currentcolor，如fill=\u0026quot;currentcolor\u0026quot;。\n而究竟他會設定成什麼顏色呢，答案是 color 這個屬性的顏色，若沒有設定 color 則會繼承 parent 的 color。\ncurrentcolor 讓我們在設定顏色時，可以透過上層的 color 來統一環境的顏色，不必單獨管理每個子元素的顏色。\n以上述提到 d3-axis 的 issue 來舉例，作者的考量是希望 axis 的顏色可以彈性的更改。若寫死成黑色，當背景色是深色的情況下，就需要靠開發者自己去重新設定顏色。\n我根據這個情境寫了一個 範例 ，讓大家可以對比這個改變的威力。\n","permalink":"https://blog.uier.tw/posts/20210516-d3-brush-fill-none/","summary":"前陣子，在修資料視覺化的同學寫作業遇到了一個問題，幫他解決後發現裡面有不少東西可以記錄下來。\n這一篇會分成三個部分\n 解決同學遇到的 bug：使用 d3-brush 後文字消失 了解 d3-brush 的行為 d3-axis 顏色的有趣發現  使用 d3-brush 後文字消失 我們要看的是下面這段程式，也可以到我的 observable 看 render 的結果。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Demo\u0026lt;/title\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/d3/5.0.0/d3.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/d3-brush/1.0.4/d3-brush.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;svg width=\u0026#34;100\u0026#34; height=\u0026#34;100\u0026#34;\u0026gt;\u0026lt;/svg\u0026gt; \u0026lt;script\u0026gt; const brush = d3.","title":"使用 d3-brush 後文字不見？來了解 svg 的顏色設定"},{"content":"有鑑於自己不太擅長追根究底的，於是想透過做筆記的方式，來讓自己徹底了解一個陌生的知識。\n","permalink":"https://blog.uier.tw/posts/20210124-first-commit/","summary":"有鑑於自己不太擅長追根究底的，於是想透過做筆記的方式，來讓自己徹底了解一個陌生的知識。","title":"First commit"},{"content":"我是于子緯，在網路上通常用 uier 或 TzuWei 這兩個名稱。\n然後我也不知道 uier 怎麼唸，我都唸 u·i·e·r。\n臺南人，2018 年來臺北讀師大資工，對視覺的東西特別有興趣，但是我不會畫畫。\n正在學習 javascript，有時候心血來潮會寫點別的，如果想知道我最近在寫什麼可以追蹤我的 GitHub 。\n其他聯絡方式首頁都有。\n三個在我生活中花最多時間做的事：\n 睡覺 耍廢 看 Youtube  三個在我\u0008生活中最有趣的事：\n 寫程式 吃美食 跟女朋友相處  ","permalink":"https://blog.uier.tw/about/","summary":"我是于子緯，在網路上通常用 uier 或 TzuWei 這兩個名稱。\n然後我也不知道 uier 怎麼唸，我都唸 u·i·e·r。\n臺南人，2018 年來臺北讀師大資工，對視覺的東西特別有興趣，但是我不會畫畫。\n正在學習 javascript，有時候心血來潮會寫點別的，如果想知道我最近在寫什麼可以追蹤我的 GitHub 。\n其他聯絡方式首頁都有。\n三個在我生活中花最多時間做的事：\n 睡覺 耍廢 看 Youtube  三個在我\u0008生活中最有趣的事：\n 寫程式 吃美食 跟女朋友相處  ","title":"About ✨"},{"content":"","permalink":"https://blog.uier.tw/archive/","summary":"","title":"Archive"},{"content":"","permalink":"https://blog.uier.tw/search/","summary":"","title":"Search"}]